> [呉真的博客](https://blog.kuretru.com/posts/4b2e81e8/)

众所周知，千兆以太网标识的传输速度是 `1.0 Gbps`，那么在实际传输的过程中，能够达到的最大传输速度又是多少呢？这篇文章结合理论计算及实际测试告诉你答案。

#### 预备知识

##### 数据长度单位

- 计数单位：
    - 比特：`bit` 缩写 `b`，表示 1 个二进制位，可以表示 0 或 1
    - 字节：`Byte` 缩写 `B`，表示 8 个二进制位，可以表示 0~255
- 换算关系：`1 Byte = 8 bit`
- 内部换算关系：

|字节 (Byte)|比特 (bit)|
|---|---|
|1024 Byte = 1 KByte|1000 bit = 1 Kbit|
|1024 KByte = 1 MByte|1000 Kbit = 1 Mbit|
|1024 MByte = 1 GByte|1000 Mbit = 1 Gbit|

- **后文皆以 B 表示 Byte，以 b 表示 bit，务必注意区分**
- **网络设备通常以 `bit` 作为单位，而操作系统中计算文件大小通常以 `Byte` 作为单位**

##### 数据传输速度单位

- 比特率：bps (bits per second)，每秒传输比特数
- 波特率：baud，每秒传输码元数

#### 计算过程

##### 物理层

　　我们在操作系统的许多地方都可以找到，千兆以太网标识的传输速度是 `1.0 Gbps`，也就意味着在网线等传输媒介中每秒可以传输 `1 * 10^9` 个比特。换算成字节，并不能简单的除以 8，因为 Gb 与 GB 并不是简单的 8 倍关系。

- 物理层数据实际传输速度：
    - 1000 Mb
    - 119.21 MB，计算公式：`10^9 / 8 / 1024 / 1024 ≈ 119.21`

##### 数据链路层

　　在数据链路层中，[RFC894](https://tools.ietf.org/html/rfc894) 规定，以太网 MTU (最大传输单元) 为 `1500B`，也就是说一个以太网帧可以携带 1500B 的数据，加上帧头 `14B` 数据 (不考虑 `4B` 的 802.1Q 标签)，帧尾校验码 `4B` 数据，帧前导码 `8B`(7B 前导码 + 1B 帧开始界定符)，帧间间隔 `12B`，传输一个帧实际上要消耗 `1538B` 带宽。

- 数据链路层数据实际传输速度：
    - 975.29 Mb，计算公式：`1000 / 1538 * 1500 ≈ 975.29`
    - 116.26 MB，计算公式：`119.21 / 1538 * 1500 ≈ 116.26`

##### 网络层

　　如今网络层绝大多数网络设备都使用 IP 协议，其中 IPv4 首部固定长度 `20B`，可选部分最大 `40B`(这里不讨论)，IPv6 首部固定长度 `40B`，因此我们可以很容易得出网络层数据实际传输速度。

- 网络层数据实际传输速度：
    - IPv4：
        - 962.29 Mb，计算公式：`1000 / 1538 * (1500 - 20) ≈ 962.29`
        - 114.71 MB，计算公式：`119.21 / 1538 * (1500 - 20) ≈ 114.71`
    - IPv6：
        - 949.28 Mb，计算公式：`1000 / 1538 * (1500 - 40) ≈ 949.28`
        - 113.16 MB，计算公式：`119.21 / 1538 * (1500 - 40) ≈ 113.16`

##### 传输层

　　在传输层有面向连接的 TCP 协议，其中首部固定长度 `20B`，这里不考虑附加字段；面向无连接的 UDP 协议，其中首部固定长度 `8B`。

- 传输层数据实际传输速度：
    - TCP via IPv4：
        - 949.28 Mb，计算公式：`1000 / 1538 * (1500 - 20 - 20) ≈ 949.28`
        - 113.16 MB，计算公式：`119.21 / 1538 * (1500 - 20 - 20) ≈ 113.16`
    - UDP via IPv4：
        - 957.08 Mb，计算公式：`1000 / 1538 * (1500 - 20 - 8) ≈ 957.08`
        - 114.09 MB，计算公式：`119.21 / 1538 * (1500 - 20 - 8) ≈ 114.09`
    - TCP via IPv6：
        - 936.28 Mb，计算公式：`1000 / 1538 * (1500 - 40 - 20) ≈ 936.28`
        - 111.61 MB，计算公式：`119.21 / 1538 * (1500 - 40 - 20) ≈ 111.61`
    - UDP via IPv6：
        - 944.08 Mb，计算公式：`1000 / 1538 * (1500 - 40 - 8) ≈ 944.08`
        - 112.54 MB，计算公式：`119.21 / 1538 * (1500 - 40 - 8) ≈ 112.54`